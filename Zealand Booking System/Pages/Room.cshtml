@page
@model Zealand_Booking_System.Pages.RoomModel
@{
    var role = HttpContext.Session.GetString("Role"); // logget bruger rolle
    var accountId = HttpContext.Session.GetInt32("AccountID"); // logget bruger id
    var allowedRoles = new[] { "Administrator", "Teacher" }; // roller med adgang til alle
}

<body>
    <!-- SØGEFELT -->
    <form method="get" class="mb-3" style="width:50%;">
        <input type="text" name="SearchString" value="@Model.SearchString" placeholder="Søg efter lokaler..." class="form-control" />
        <button type="submit" class="btn btn-primary mt-2">Søg</button>
    </form>

    @foreach (var room in Model.Room)
    {
        if (Model.EditRoomID == room.RoomID)
        {
            <!-- REDIGERINGSTILSTAND -->
            <form method="post" asp-page-handler="SaveEdit">

                <!-- SKJULT FELT MED ID BUNDET TIL EditRoom.RoomID -->
                <input asp-for="EditRoom.RoomID" type="hidden" />

                <label>Lokalenavn:</label>
                <input asp-for="EditRoom.RoomName" class="form-control" />

                <label>Lokation:</label>
                <input asp-for="EditRoom.RoomLocation" class="form-control" />

                @* <label>Størrelse:</label>
                <input asp-for="EditRoom.Size" class="form-control" type="number" /> *@

                <label>Beskrivelse:</label>
                <textarea asp-for="EditRoom.RoomDescription" class="form-control"></textarea>

                <!-- ROOMTYPE DROPDOWN -->
                <label>Lokaletype:</label>
                <select asp-for="EditRoom.RoomType"
                        asp-items="Html.GetEnumSelectList<Zealand_Booking_System_Library.Models.RoomType>()"
                        class="form-control">
                </select>

                <!-- HASSMARTBOARD CHECKBOX -->
                <div class="form-check" style="margin-top:10px;">
                    <input asp-for="EditRoom.HasSmartBoard" class="form-check-input" type="checkbox" />
                    <label asp-for="EditRoom.HasSmartBoard" class="form-check-label">Har smartboard</label>
                </div>

                <button type="submit" class="btn btn-success" style="margin-top:10px;">Gem</button>

                <a href="/Room" class="btn btn-secondary" style="margin-top:10px;">Fortryd</a>
            </form>
        }
        else
        {
            <!-- VISNINGSTILSTAND -->
            <h5 class="card-title">@room.RoomName</h5>
            <p>
                @* Størrelse: @room.Size <br /> *@
                Lokation: @room.RoomLocation <br />
                Type: @room.RoomType <br />
                Smartboard: @(room.HasSmartBoard ? "Ja" : "Nej") <br />
                @room.RoomDescription
            </p>

            <!-- SLET -->
            @if (allowedRoles.Contains(role))
            {
                <form method="post" asp-page-handler="Delete" style="display:inline;">
                    <input type="hidden" name="roomID" value="@room.RoomID" />
                    <button type="submit" class="btn btn-danger">Slet</button>
                </form>
            }

            <!-- REDIGER -->
            @if (allowedRoles.Contains(role))
            {
                <form method="post" asp-page-handler="StartEdit" style="display:inline;">
                    <input type="hidden" name="roomID" value="@room.RoomID" />
                    <button type="submit" class="btn btn-warning">Rediger</button>
                </form>
            }

            <!-- BOOK -->
            <a asp-page="/CreateBooking" class="btn btn-success">
                Book lokalet
            </a>
        }
    }
    @if (allowedRoles.Contains(role)) 
    {
    <!-- FORMULAR TIL AT OPRETTE NYT LOKALE -->
    <h3>Opret nyt lokale</h3>
    <form method="post" style="width:50%; margin-bottom: 30px;">
        @Html.AntiForgeryToken()
        <div class="mb-2">
            <label for="RoomName">Lokalenavn:</label><br />
            <input asp-for="NewRoom.RoomName" id="RoomName" required class="form-control" />
        </div>

        <div class="mb-2">
            <label for="RoomLocation">Lokation:</label><br />
            <input asp-for="NewRoom.RoomLocation" id="RoomLocation" required class="form-control" />
        </div>

       @*  <div class="mb-2">
            <label for="Size">Størrelse:</label><br />
            <input asp-for="NewRoom.Size" id="Size" type="number" required class="form-control" />
        </div> *@

        <div class="mb-2">
            <label for="RoomDescription">Beskrivelse:</label><br />
            <textarea asp-for="NewRoom.RoomDescription" id="RoomDescription" class="form-control"></textarea>
        </div>

        <!-- ROOMTYPE DROPDOWN -->
        <div class="mb-2">
            <label>Lokaletype:</label><br />
            <select asp-for="NewRoom.RoomType"
                    asp-items="Html.GetEnumSelectList<Zealand_Booking_System_Library.Models.RoomType>()"
                    class="form-control">
                <option value="">-- Vælg type --</option>
            </select>
        </div>

        <!-- HASSMARTBOARD CHECKBOX -->
        <div class="form-check mb-2">
            <input asp-for="NewRoom.HasSmartBoard" class="form-check-input" type="checkbox" />
            <label asp-for="NewRoom.HasSmartBoard" class="form-check-label">Har smartboard</label>
        </div>

        <button type="submit" class="btn btn-primary mt-2">Opret lokale</button>
    </form>
    }
</body>
