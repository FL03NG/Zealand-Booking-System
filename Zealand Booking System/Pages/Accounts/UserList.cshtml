@page
@model Zealand_Booking_System.Pages.Accounts.UserListModel
@using Zealand_Booking_System_Library.Models
@{
    /*
        This page provides administrators with an overview of all user accounts.
        It supports searching, inline editing, and deletion while keeping all
        management actions in one consolidated interface.
    */
    ViewData["Title"] = "User list";
}

<section class="my-4 my-md-5">
    <h1 class="zb-section-title mb-3">Userlist</h1>
    <!--
        Searching is implemented as a server-side post to ensure results
        remain consistent with backend validation and authorization.
    -->
    <div class="zb-form-card mb-4">
        <form method="post" asp-page-handler="Search" class="mb-0">
            <label asp-for="SearchName" class="form-label">Search username</label>
            <div class="input-group">
                <input asp-for="SearchName" class="form-control" placeholder="Search username..." />
                <button type="submit" class="btn zb-btn-primary">
                    Search
                </button>
            </div>
        </form>
    </div>
    @*
        Feedback messages are shown centrally to give clear confirmation
        of actions such as updates or deletions.
    *@
    @if (!string.IsNullOrEmpty(Model.Message))
    {
        <div class="alert alert-info">@Model.Message</div>
    }
    @*
        An explicit empty-state message avoids confusion when no results
        match the current search or filter criteria.
    *@
    @if (Model.Users == null || Model.Users.Count == 0)
    {
        <p>There are no users.</p>
    }
    else
    {
        <div class="zb-table-card">
            <div class="table-responsive">
                @*
                    A table layout is used here to support quick scanning
                    and comparison of user attributes.
                *@
                <table class="table table-sm align-middle zb-table">
                    <thead>
                        <tr>
                            <th>AccountID</th>
                            <th>Username</th>
                            <th>Role</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (Account user in Model.Users)
                        {
                            if (Model.EditUserID == user.AccountID)
                            {
                                @*
                                    Inline edit mode keeps administrators in context,
                                    reducing the risk of editing the wrong account.
                                *@
                                <tr>
                                    <form method="post" asp-page-handler="SaveEdit">
                                    <td>
                                        @user.AccountID
                                        <input type="hidden" asp-for="EditUser.AccountID" />
                                    </td>

                                    <td>
                                        <input asp-for="EditUser.Username" class="form-control" />
                                    </td>

                                    <td>
                                        @*
                                                Role selection is restricted to predefined
                                                values to prevent invalid system states.
                                        *@
                                        <select asp-for="EditUser.Role" class="form-select">
                                            <option value="Administrator">Administrator</option>
                                            <option value="Teacher">Teacher</option>
                                            <option value="Student">Student</option>
                                        </select>
                                    </td>

                                    <td>
                                        <button type="submit" class="btn btn-success btn-sm">Save</button>
                                        <a asp-page="./UserList" class="btn zb-btn-secondary btn-sm">Regret</a>
                                    </td>
                                    </form>
                                </tr>
                            }
                            else
                            {
                                @*
                                    Display mode prioritizes readability while
                                    keeping key management actions immediately accessible.
                                *@
                                <tr>
                                    <td>@user.AccountID</td>
                                    <td>@user.Username</td>
                                    <td>@user.Role</td>
                                    <td>
                                        @*
                                            Deletion is handled via POST to avoid
                                            accidental actions through link navigation.
                                        *@
                                        <form method="post" asp-page-handler="Delete" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?')">
                                            <input type="hidden" name="accountID" value="@user.AccountID" />
                                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                        </form>
                                        <form method="post" asp-page-handler="StartEdit" class="d-inline">
                                            <input type="hidden" name="accountID" value="@user.AccountID" />
                                            <button type="submit" class="btn btn-warning btn-sm">Edit</button>
                                        </form>
                                    </td>
                                </tr>
                            }
                        }
                    </tbody>
                </table>
            </div>
        </div>
    }
</section>
